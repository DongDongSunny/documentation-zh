<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://tronprotocol.github.io/documentation-zh/mechanism-algorithm/resource/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>资源模型 - Java Tron</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u8d44\u6e90\u6a21\u578b";
        var mkdocs_page_input_path = "mechanism-algorithm/resource.md";
        var mkdocs_page_url = "/documentation-zh/mechanism-algorithm/resource/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Java Tron
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">入门</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../getting_started/getting_started_with_javatron/">Java-tron入门</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">使用Java-tron</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/installing_javatron/">部署Java-tron</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/backup_restore/">备份和恢复</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/litefullnode/">轻节点</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/private_network/">私链网络</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../architecture/event/">事件插件</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../architecture/database/">数据库配置</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/connecting_to_tron/">网络配置</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../using_javatron/metrics/">节点监控</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">工具</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../using_javatron/toolkit/">数据库迁移</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../using_javatron/litefullnode-tool.md">轻节点工具</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API 接口</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/http/">HTTP 接口</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/rpc/">gRPC 接口</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">核心协议</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../introduction/dpos/">波场共识</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sr/">超级代表</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../account/">账户模型</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">资源模型</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#_2">资源模型介绍</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_3">带宽</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1-bandwidth-points">1. Bandwidth Points的来源</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-bandwith-points">2. Bandwith Points的消耗</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3-bandwidth-points">3. Bandwidth Points的计算规则</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#4">4. 带宽的自动恢复</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_4">能量</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1-energy">1. Energy的获取</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freezebalance">FreezeBalance 质押获得能量</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freezebalance_1">FreezeBalance 恢复能量</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-feelimit">2. 如何填写 feeLimit(用户必读)</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3-energy">3. Energy的计算(开发者必读)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_5">资源委托</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_6">其他交易费</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../contracts/contract/">智能合约</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dex/">去中心化交易所</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../multi-signatures/">多重签名</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Java-tron开发</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/java-tron/">开发者指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/tips/">TIPs工作流程</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/issue-workflow/">Issue工作流程</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/run-in-idea/">配置IDE开发环境</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/demo/">开发示例</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../developers/gpg/">GPG Key</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Dapp开发</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../contracts/compiler/">Dapp开发工具</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Wallet-cli</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../clients/wallet-cli/">安装</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">版本发布</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">历史版本</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v452/">GreatVoyage-v4.5.2</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v451/">GreatVoyage-v4.5.1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v446/">GreatVoyage-v4.4.6</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v445/">GreatVoyage-v4.4.5</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v444/">GreatVoyage-v4.4.4</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v442/">GreatVoyage-v4.4.2</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v440/">GreatVoyage-v4.4.0</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v430/">GreatVoyage-v4.3.0</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v4221/">GreatVoyage-v4.2.2.1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v422/">GreatVoyage-v4.2.2</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v420/">GreatVoyage-v4.2.0</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v413/">GreatVoyage-v4.1.3</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v412/">GreatVoyage-v4.1.2</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v411/">GreatVoyage-v4.1.1</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/GreatVoyage-v400/">GreatVoyage-v4.0.0</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/Odyssey-v37/">Odyssey-v3.7</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../releases/Odyssey-v365/">Odyssey-v3.6.5</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../releases/">一致性检验</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../glossary/">术语表</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Java Tron</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>核心协议 &raquo;</li><li>资源模型</li>
    <li class="wy-breadcrumbs-aside">
        <a href="https://github.com/tronprotocol/documentation-zh/edit/master/docs/mechanism-algorithm/resource.md"
          class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="_1">资源模型<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">资源模型介绍<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>TRON网络中的资源有4种：带宽，CPU，存储和内存。得益于波场独有的内存模型，TRON网络中的内存资源几乎是无限的。
TRON网络引入了Bandwidth point 和 Energy 两种资源概念。其中Bandwidth Point表示带宽资源，Energy表示CPU和存储资源。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>普通交易仅消耗Bandwidth points</li>
<li>智能合约的操作不仅要消耗Bandwidth points，还会消耗Energy</li>
</ul>
</div>
<h2 id="_3">带宽<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>交易以字节数组的形式在网络中传输及存储，一条交易消耗的 Bandwidth Points = 交易字节数 * Bandwidth Points费率。当前 Bandwidth Points费率 = 1.</p>
<p>如一条交易的字节数组长度为200，那么该交易需要消耗 200 Bandwidth Points。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>由于网络中总质押资金以及账户的质押资金随时可能发生变化，因此账户拥有的 Bandwidth Points 不是固定值。</p>
</div>
<h3 id="1-bandwidth-points">1. Bandwidth Points的来源<a class="headerlink" href="#1-bandwidth-points" title="Permanent link">&para;</a></h3>
<p>Bandwidth Points的获取分两种：</p>
<ul>
<li>通过质押TRX获取的Bandwidth Points， 额度 = 为获取Bandwidth Points质押的TRX / 整个网络为获取Bandwidth Points质押的TRX 总额 * 43_200_000_000. 也就是所有用户按质押TRX平分固定额度的Bandwidth Points.</li>
<li>每个账号每天有固定免费额度的带宽，为5000.</li>
</ul>
<h3 id="2-bandwith-points">2. Bandwith Points的消耗<a class="headerlink" href="#2-bandwith-points" title="Permanent link">&para;</a></h3>
<p>除了查询操作，任何交易都需要消耗 bandwidth points。</p>
<p>有一种特殊情况需要注意，如果是转账，包括普通转账或 TRC10 Token 转账，如果目标账户不存在，转账操作则会创建账户并转账，只会扣除创建账户消耗的Bandwidth Points，转账不会再消耗额外的Bandwidth Points.</p>
<h3 id="3-bandwidth-points">3. Bandwidth Points的计算规则<a class="headerlink" href="#3-bandwidth-points" title="Permanent link">&para;</a></h3>
<p>Bandwidth Points是一个账户1天内能够使用的总字节数。一定时间内，整个网络能够处理的Bandwidth为确定值。</p>
<p>如果交易需要创建新账户，Bandwidth Points消耗如下：</p>
<ol>
<li>尝试消耗交易发起者质押获取的Bandwidth Points。如果交易发起者Bandwidth Points不足，则进入下一步</li>
<li>尝试消耗交易发起者的TRX，这部分烧掉0.1TRX</li>
</ol>
<p>如果交易是Token转账，Bandwidth Points消耗如下：</p>
<ol>
<li>依次验证 发行Token资产总的免费Bandwidth Points是否足够消耗，转账发起者的Token剩余免费Bandwidth Points是否足够消耗，Token发行者质押TRX获取Bandwidth Points剩余量是否足够消耗。如果满足则扣除Token发行者的Bandwidth Points，任意一个不满足则进入下一步</li>
<li>尝试消耗交易发起者质押获取的Bandwidth Points。如果交易发起者Bandwidth Points不足，则进入下一步</li>
<li>尝试消耗交易发起者的免费Bandwidth Points。如果免费Bandwidth Points也不足，则进入下一步</li>
<li>尝试消耗交易发起者的TRX，交易的字节数 * 1000 sun</li>
</ol>
<p>如果交易普通交易，Bandwidth Points消耗如下：</p>
<ol>
<li>尝试消耗交易发起者质押获取的Bandwidth Points。如果交易发起者Bandwidth Points不足，则进入下一步</li>
<li>尝试消耗交易发起者的免费Bandwidth Points。如果免费Bandwidth Points也不足，则进入下一步</li>
<li>尝试消耗交易发起者的TRX，交易的字节数 * 1000 sun</li>
</ol>
<h3 id="4">4. 带宽的自动恢复<a class="headerlink" href="#4" title="Permanent link">&para;</a></h3>
<p>在网络总锁定资金以及账户锁定资金不变的情况向，账户的带宽的已使用量随着时间增加而按比例衰减，24h 衰减到 0. 如时间 <span class="arithmatex"><span class="MathJax_Preview">T_1</span><script type="math/tex">T_1</script></span> 时刻，账户带宽已使用量为 <span class="arithmatex"><span class="MathJax_Preview">U</span><script type="math/tex">U</script></span>, 到 <span class="arithmatex"><span class="MathJax_Preview">T_1 + 12h</span><script type="math/tex">T_1 + 12h</script></span> ，账户再次使用带宽 <span class="arithmatex"><span class="MathJax_Preview">u</span><script type="math/tex">u</script></span>, 此时账户已使用带宽为 <span class="arithmatex"><span class="MathJax_Preview">U / 2 + u</span><script type="math/tex">U / 2 + u</script></span>. 具体公式如下：</p>
<div class="arithmatex">
<div class="MathJax_Preview">
U^\prime = ( 1 - \frac{T_2 - T_1}{24h} ) * U + u
</div>
<script type="math/tex; mode=display">
U^\prime = ( 1 - \frac{T_2 - T_1}{24h} ) * U + u
</script>
</div>
<p>即可以理解为每 24h，用户已使用的带宽值重置为0。</p>
<h2 id="_4">能量<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>智能合约运行时执行每一条指令都需要消耗一定的系统资源，资源的多少用Energy的值来衡量。</p>
<h3 id="1-energy">1. Energy的获取<a class="headerlink" href="#1-energy" title="Permanent link">&para;</a></h3>
<p>质押获取Energy，即将持有的trx锁定，无法进行交易，作为抵押，并以此获得免费使用Energy的权利。具体计算与全网所有账户质押有关，可参考相关部分计算。</p>
<h4 id="freezebalance">FreezeBalance 质押获得能量<a class="headerlink" href="#freezebalance" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>freezeBalance frozen_balance frozen_duration [ResourceCode:0 BANDWIDTH,1 ENERGY]
</code></pre></div>
<p>通过质押TRX获取的Energy， 额度 = 为获取Energy质押的TRX / 整个网络为获取Energy质押的TRX 总额 * 50_000_000_000。
也就是所有用户按质押TRX平分固定额度的Energy。</p>
<p>示例：</p>
<div class="highlight"><pre><span></span><code>如全网只有两个人A，B分别质押2TRX，2TRX。

二人质押获得的可用Energy分别是

A: 25_000_000_000 且energy_limit 为25_000_000_000

B: 25_000_000_000 且energy_limit 为25_000_000_000

当第三人C质押1TRX时。

三人质押获得的可用Energy调整为

A: 20_000_000_000 且energy_limit调整为20_000_000_000

B: 20_000_000_000 且energy_limit调整为20_000_000_000

B: 10_000_000_000 且energy_limit 为10_000_000_000
</code></pre></div>
<h4 id="freezebalance_1">FreezeBalance 恢复能量<a class="headerlink" href="#freezebalance_1" title="Permanent link">&para;</a></h4>
<p>所消耗的能量会在24小时内平滑减少至0。</p>
<p>示例：</p>
<div class="highlight"><pre><span></span><code>在某一时刻A的Energy已使用量为72_000_000 Energy

在没有其他消耗或质押的操作下：

一小时后A的Energy已使用量为 72_000_000 - (72_000_000 * (60*60/60*60*24)) Energy = 69_000_000 Energy

24小时后A的Energy已使用量为 0 Energy。
</code></pre></div>
<h3 id="2-feelimit">2. 如何填写 feeLimit(用户必读)<a class="headerlink" href="#2-feelimit" title="Permanent link">&para;</a></h3>
<hr />
<p><em>在本节范围内，将合约的开发部署人员，简称为“开发者”；将调用合约的用户或者其他合约，简称为“调用者”。</em></p>
<p><em>调用合约消耗的Energy能以一定比例折合成trx（或者sun），所以在本节范围内，指代合约消耗的资源时，并不严格区分Energy和 trx；仅在作为 数值的单位时，才区分Energy、trx和sun。</em></p>
<hr />
<p>合理设置feeLimit，一方面能尽量保证正常执行；另外一方面，如果合约所需Energy过大，又不会过多消耗调用者的trx。在设置feeLimit之前，需要了解几个概念：</p>
<ol>
<li>合法的feeLimit为0 - 10^9 之间的整数值，单位是sun，折合0 - 1000 trx；</li>
<li>不同复杂度的合约，每次正常执行消耗不同的Energy；相同合约每次消耗的Energy基本相同<sup id="fnref2:1"><a class="footnote-ref" href="#fn:1">1</a></sup>；执行合约时，逐条指令计算并扣除Energy，如果超过feeLimit的限制，则合约执行失败，已扣除的Energy不退还；</li>
<li>目前feeLimit仅指调用者愿意承担的Energy折合的trx<sup id="fnref2:2"><a class="footnote-ref" href="#fn:2">2</a></sup>；执行合约允许的最大Energy还包括开发者承担的部分；</li>
<li>一个恶意合约，如果最终执行超时，或者因bug合约崩溃，则会扣除该合约允许的所有energy；</li>
<li>开发者可能会承担一定比例的Energy消耗（比如承担90%）。但是，当开发者账户的Energy不足以支付时，剩余部分完全由调用者承担。在feeLimit限制范围内，如调用者的Energy不足，则会燃烧等价值的trx。<sup id="fnref3:2"><a class="footnote-ref" href="#fn:2">2</a></sup></li>
</ol>
<p>开发者通常会有充足的Energy，以鼓励低成本调用；调用者在估算feeLimit时，可以假设开发者能够承担其承诺比例的Energy，如果一次调用因为feeLimit不足而失败，可以再适当扩大。</p>
<p><strong>示例</strong>
下面将以一个合约C的执行，来具体举例，如何估算feeLimit：</p>
<ul>
<li>假设合约C上一次成功执行时，消耗了18000 Energy，那么预估本次执行消耗的Energy上限为20000 Energy；<sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup></li>
<li>质押trx时，当前全网用于CPU质押的TRX总量和Energy总量的比值，假设是质押1 trx，可以获得400 Energy；</li>
<li>燃烧trx时，4 trx固定可以兑换100000 Energy；<sup id="fnref:4"><a class="footnote-ref" href="#fn:4">4</a></sup></li>
<li>假设开发者承诺承担90%的Energy，而且开发者账户有充足的Energy；</li>
</ul>
<p>则，feeLimit的预估方法为：</p>
<ol>
<li>A = 20000 energy * (1 trx / 400 energy) = 50 trx = 50_000_000 sun,</li>
<li>B = 20000 energy * (4 trx / 10000 energy) = 0.8 trx = 800_000 sun，</li>
<li>取A和B的最大值，为50_000_000 sun，</li>
<li>开发者承诺承担90%，用户需要承担10%，</li>
</ol>
<p>那么，建议用户填写的feeLimit为 50_000_000 sun * 10% = 5_000_000 sun。</p>
<h3 id="3-energy">3. Energy的计算(开发者必读)<a class="headerlink" href="#3-energy" title="Permanent link">&para;</a></h3>
<p>在讨论本章节前，需要了解：</p>
<ol>
<li>tron为了惩罚恶意开发者，对于异常合约，如果执行超时（超过50ms），或因bug异常退出（不包含revert），会扣除本次的最大可用Energy。若合约正常执行，或revert，则仅扣除执行相关指令所需的Energy；</li>
<li>开发者可以设置执行合约时，消耗Energy中自己承担的比例，该比例后续可修改。一次合约调用消耗的Energy，若开发者的Energy不足以支付其承担的部分，剩余部分全由调用者支付；</li>
<li>目前执行一个合约，可用的Energy总数由 调用者调用时设置的feeLimit 和 开发者承担部分共同决定；</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ol>
<li>若开发者不确定合约是否正常，请勿将用户承担比例设置为0%，否则在被判为恶意执行时，会扣除开发者的所有Energy。<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup></li>
<li>因此建议开发者设置的用户承担的比例为10%~100%。<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup></li>
</ol>
</div>
<p>下面具体举例，详细描述合约可用Energy的计算方法。</p>
<p><strong>示例1</strong>
如果一个账户A的balance是 100 TRX(100_000_000 SUN)，质押 10 TRX 获得了100000 Energy，未质押的balance是 90 TRX。
有一个合约C设置的消耗调用者资源的比例是100%，也就是完全由调用者支付所需资源。
此时A调用了合约C，填写的feeLimit是 30000000(单位是SUN, 30 TRX)。
那么A此次调用能够使用的Energy是由两部分计算出来的：</p>
<ul>
<li>
<p>A质押剩余的Energy</p>
<p>这部分的价格是根据账户A当前质押的TRX和当前质押所获得的Energy总量按比例计算出来的，也就是：1 Energy = (10 / 100000) TRX，还剩100000 Energy，价值10 TRX，小于feeLimit，则能获得所有的100000 Energy，价值的10 TRX算进feeLimit中。</p>
</li>
<li>
<p>按照固定比例换算出来的Energy</p>
<p>如果feeLimit大于质押剩余Energy价值的TRX，那么需要使用balance中的TRX来换算。固定比例是： 1 Energy = 100 SUN, feeLimit还有(30 - 10) TRX = 20 TRX，获得的Energy是 20 TRX / 100 SUN = 200000 Energy</p>
</li>
</ul>
<p>所以，A此次调用能够使用的Energy是 (100000 + 200000) = 300000 Energy</p>
<p>如果合约执行成功，没有发生任何异常，则会扣除合约运行实际消耗的Energy，一般都远远小于此次调用能够使用的Energy。如果发生了Assert-style异常，则会消耗feeLimit对应的所有的Energy。</p>
<p>Assert-style异常的介绍详见<a href="https://github.com/tronprotocol/Documentation/blob/master/%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/%E8%99%9A%E6%8B%9F%E6%9C%BA/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.md">异常介绍</a></p>
<p><strong>示例2</strong>
如果一个账户A的balance是 100 TRX(100000000 SUN)，质押 10 TRX 获得了100000 Energy，未质押的balance是 90 TRX。
有一个合约C设置的消耗调用者资源的比例是40%，也就是由合约开发者支付所需资源的60%。
开发者是D，质押 50 TRX 获得了500000 Energy。
此时A调用了合约C，填写的feeLimit是 200000000(单位是SUN, 200 TRX)。
那么A此次调用能够使用的Energy是于以下三部分相关：</p>
<ul>
<li>
<p>调用者A质押剩余的Energy（X Energy）</p>
<p>这部分的价格是根据账户A当前质押的TRX和当前质押所获得的Energy总量按比例计算出来的，也就是：1 Energy = (10 / 100000) TRX，还剩100000 Energy，价值10 TRX，小于剩下的feeLimit，则能获得所有的100000 Energy，价值的10 TRX算进feeLimit中。</p>
</li>
<li>
<p>从调用者A的balance中，按照固定比例换算出来的Energy （Y Energy）</p>
<p>如果feeLimit大于1和2的和，那么需要使用A的balance中的TRX来换算。固定比例是： 1 Energy = 100 SUN, feeLimit还有(200 - 10)TRX = 190 TRX，但是A的balance只有90 TRX，按照min(190 TRX, 90 TRX) = 90 TRX来计算获得的Energy，即为 90 TRX / 100 SUN = 900000 Energy</p>
</li>
<li>
<p>开发者D质押剩余的Energy (Z Energy)</p>
<p>开发者D质押剩余500000 Energy。</p>
</li>
</ul>
<p>会出现以下两种情况：</p>
<ul>
<li>当(X + Y) / 40% &gt;= Z / 60%，A此次调用能够使用的Energy是 X + Y + Z Energy。</li>
<li>当(X + Y) / 40% &lt; Z / 60%，A此次调用能够使用的Energy是 (X + Y) / 40% Energy。</li>
</ul>
<p>若A此次调用能够使用的Energy是 Q Energy</p>
<p>同上，如果合约执行成功，没有发生任何异常，消耗总Energy小于Q Energy，如消耗 500000 Energy ，会按照比例扣除合约运行实际消耗的Energy，调用者A消耗 <span class="arithmatex"><span class="MathJax_Preview">500000 * 40\% =200000</span><script type="math/tex">500000 * 40\% =200000</script></span> Energy，开发者D消耗 <span class="arithmatex"><span class="MathJax_Preview">500000 * 60\% = 300000</span><script type="math/tex">500000 * 60\% = 300000</script></span> Energy。</p>
<p>一般实际消耗Energy都远远小于此次调用能够使用的Energy。如果发生了Assert-style异常，则会消耗feeLimit对应的所有的Energy。</p>
<p>Assert-style异常的介绍详见<a href="https://github.com/tronprotocol/Documentation/blob/master/%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/%E8%99%9A%E6%8B%9F%E6%9C%BA/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.md">异常介绍</a></p>
<p>注意：
开发者创建合约的时候，consume_user_resource_percent不要设置成0，也就是开发者自己承担所有资源消耗。
开发者自己承担所有资源消耗，意味着当发生了Assert-style异常时，会消耗开发者质押的所有Energy。
Assert-style异常的介绍详见<a href="https://github.com/tronprotocol/Documentation/blob/master/%E4%B8%AD%E6%96%87%E6%96%87%E6%A1%A3/%E8%99%9A%E6%8B%9F%E6%9C%BA/%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86.md">异常介绍</a></p>
<p>为避免造成不必要的损失consume_user_resource_percent建议值是10-100。</p>
<h2 id="_5">资源委托<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>在TRON中，一个账户可以通过质押TRX来获取带宽和能量。同时，也可以把质押TRX获取的带宽或者能量委托（delegate）给其他地址。
此时，主账号拥有质押的TRX以及相应的投票权，受委托账户拥有质押获取的资源（带宽或者能量）。
和普通质押一样，委托资源也至少质押3天。</p>
<p>资源委托的命令如下：</p>
<div class="highlight"><pre><span></span><code>freezeBalance frozen_balance frozen_duration [ResourceCode:0 BANDWIDTH,1 ENERGY] [receiverAddress]

frozen_balance是质押的TRX数量（单位为sun）
frozen_duration为质押的天数（目前固定为3天）
ResourceCode表示要获取的资源是带宽还是能量
receiverAddress表示受委托账户的地址
</code></pre></div>
<h2 id="_6">其他交易费<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th style="text-align: left;">交易类型</th>
<th style="text-align: center;">费用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">创建witness</td>
<td style="text-align: center;">9999 TRX</td>
</tr>
<tr>
<td style="text-align: left;">发行token</td>
<td style="text-align: center;">1024 TRX</td>
</tr>
<tr>
<td style="text-align: left;">创建account</td>
<td style="text-align: center;">1 TRX</td>
</tr>
<tr>
<td style="text-align: left;">创建exchange</td>
<td style="text-align: center;">1024 TRX</td>
</tr>
</tbody>
</table>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>根据tron各节点的情况，每次执行消耗的Energy可能会有小幅度的浮动。&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>tron可能会视后续公链的情况，调整这一策略。&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a><a class="footnote-backref" href="#fnref2:2" title="Jump back to footnote 2 in the text">&#8617;</a><a class="footnote-backref" href="#fnref3:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p>预估的下一次执行所需Energy上限，应该略大于上一次实际消耗的Energy。&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p>4 trx = 10^5 energy 为目前的燃烧trx的比例，后续Tron可能会根据全网拥塞情况调整，调整后，将通知到全网的节点。&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
</ol>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../account/" class="btn btn-neutral float-left" title="账户模型"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../contracts/contract/" class="btn btn-neutral float-right" title="智能合约">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/tronprotocol/documentation-zh" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../account/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../contracts/contract/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
